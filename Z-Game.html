<!DOCTYPE html>
<html lang="en">
<link type="text/css" rel="stylesheet" href="css/main.css">

<head>
    <meta charset="UTF-8">
    <title>Z-Game</title>
    <script type="text/javascript" src="src/js/three.js-master/build/three.js"></script>
    <script type="text/javascript" src="exLibs/jquery-1.9.0.js"></script>
    <script type="text/javascript" src="exLibs/stats.js"></script>
    <script type="text/javascript" src="exLibs/dat.gui.js"></script>
    <script type="text/javascript" src="exLibs/OBJLoader.js"></script>
    <script type="text/javascript" src="exLibs/MTLLoader.js"></script>
    <script type="text/javascript" src="exLibs/physi.js"></script>
    <script type="text/javascript" src="exLibs/howler.js"></script>
    <script type="text/javascript" src="src/js/gameFiles/zombie.js"></script>
    <script type="text/javascript" src="src/js/gameFiles/crosshair.js"></script>
    <script type="text/javascript" src="src/js/gameFiles/avatar.js"></script>
    <script type="text/javascript" src="src/js/gameFiles/bullet.js"></script>
    <script type="text/javascript" src="src/js/gameFiles/world.js"></script>
    <script type="text/javascript" src="src/js/gameFiles/gameScene.js"></script>
    <script type="text/javascript" src="src/js/gameFiles/gameStartScript.js"></script>

    <div id="blocker">
        <h1 align="center" ><span style="color:crimson" id="Z-GAME"> Z-GAME </span></h1>
        <h2 align="center"><span style="color: rebeccapurple" id="Options"> Options </span> </h2>
        <h2 align="center"><span style="color: white" id="Play" class="Play"> Loading... </span> </h2>
        <div id="instructions">
            <!--
            <span id="title" style="font-size:30px">Click to start game</span>
            <br/>
            Move: WASD
            <br/>
            Jump: Space
            <br/>
            Left click: Shoot
            <br/>
            Look: Mouse
            <br/>
            Pause: ESC
            -->
        </div>

    </div>

    <style>
        body{
            margin: 0;
            overflow: hidden;
        }

        #blocker {

            position: absolute;

            width: 100%;
            height: 100%;

            background-color: rgba(0,0,0,1);
        }

        #instructions {

            width: 100%;
            height: 100%;

            display: -webkit-box;
            display: -moz-box;
            display: box;

            -webkit-box-orient: horizontal;
            -moz-box-orient: horizontal;
            box-orient: horizontal;

            -webkit-box-pack: center;
            -moz-box-pack: center;
            box-pack: center;

            -webkit-box-align: center;
            -moz-box-align: center;
            box-align: center;

            color: #ffffff;
            text-align: center;

            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="Stats-output">

</div>

<div style="position:absolute; left:100px; top:10px" id="Messages">

</div>

<div id="WebGL-output">

</div>
<script type="module">

    let loadDone = 0;
    let loadTotal = 0;

    import {GLTFLoader} from "./src/js/three.js-master/examples/jsm/loaders/GLTFLoader.js";
    let gunGtlfloader = new GLTFLoader();

    //gun
    loadTotal++;
    gunGtlfloader.load(
        'models/MagicianAllAni.glb',
        function (playerModel) {
            importPlayer(playerModel);

            loadDone++;
            checkLoad();

        },
        function ( xhr ) {

            console.log('Gun loading: ' + (xhr.loaded/xhr.total * 100) + '%');

        },
        function ( error ) {

            console.error( 'Error loading gun: ' + error);

        }
    );

    //zombie
    let zombieImportArray = [];
    let zNum = 5;
    zombieNum = zNum;
    loadTotal += zNum;
    for (let i = 0 ; i < zNum ; i++) {
        let zLoader = new GLTFLoader();
        zLoader.load(
            'models/zombieWalk6.glb',
            function (zombieImport) {

                let zombieImportScene = zombieImport.scene;
                //zombieImportScene.rotation.x = 90;
                zombieImportScene.scale.set(7,7,7);
                zombieImportScene.traverse((object) => {
                    if (object.isMesh) object.frustumCulled = false;
                });


                zombieImportArray.push(zombieImportScene);
                if (zombieImportArray.length === zombieNum) {
                    importZombie(zombieImportArray);
                }
                loadDone += 1;
                checkLoad();

            },
            function (xhr) {
                console.log('Zombie model loading: ' + (xhr.loaded/xhr.total * 100) + '%');
            },
            function (err) {
                console.error('Error loading Zombie model: ' + err);
            }
        );
    }


    let bulletLoader = new GLTFLoader();
    loadTotal++;
    bulletLoader.load(
        './models/metalOrbGit.glb',
        function (bulletImport) {

            importBullet(bulletImport);

            loadDone++;
            checkLoad();
        },
        function (xhr) {
            console.log('Bullet model loading: ' + (xhr.loaded/xhr.total * 100) + '%');
        },
        function (err) {
            console.error('Error loading bullet model: ' + err);
        }
    );

    //for each object
    //create a new gltfLoader() object
    //add one to loadtotal for each object imported
    // load the object using <loader name>.load(
    // '<path to file>',
    // function(<import object>){ <onload function>}, ##call a function in gameStartScript and pass parameter to assign to an object
    // function(xhr) {<update function>} ##keep console logging in the same format as above
    // function(xhr) {<error function>} ##keep console error in the same format as above

    /*
    let worldLoader = new GLTFLoader();
    loadTotal++;
    worldLoader.load(
        './models/Draft/world.glb',
        function (worldImport) {

            importWorld(worldImport); //calling function in gameStartScript

            loadDone++;
            checkLoad();

        },
        function (xhr){
            console.log('World model loading: ' + (xhr.loaded/xhr.total * 100) + '%');
        },
        function (err){
        console.error('Error loading world model: ' + err);
        }
    )
     */


    function checkLoad(){
        if (loadDone === loadTotal){
            console.log("done!")
            let play = document.getElementById("Play");
            play.style.color = "yellowgreen";
            play.innerHTML = "Play!";
            play.onclick = function() {
                loadMain();
            }
        } else {console.log("loading still");}
    }

    function loadMain(){
        let play = document.getElementById("Play");
        play.style.color = "orange";
        play.innerHTML = "Starting...";
        main();
    }

</script>

</body>
</html>